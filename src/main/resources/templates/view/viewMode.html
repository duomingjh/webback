<!DOCTYPE html>
<html lang="en">
<head>
    <title>测试</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <style>
        * {
            touch-action: pan-y;
        }
        body {
            font-family: Monospace;
            background: url("/modes/absd/ui/all_bg.jpg") center repeat ;
            background-size: 100% 100%;

            color: #fff;
            margin: 0px;
            overflow: hidden;
        }
        #info {
            color: #fff;
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            z-index: 100;
            display:block;
        }
        #info a {
            color: #046;
            font-weight: bold;
        }
        .box4 {
            width: 10%;
            height: 8%;
            background: url("/modes/ui/p2_left.png") center repeat ;
            background-size: 100% 100%;
            position: absolute;

            left:20%;
            border: none;
            bottom: 10%;
        }
        .box3 {
            width: 10%;
            height: 8%;
            background: url("/modes/ui/p2_right.png") center no-repeat ;
            background-size: 100% 100%;
            position: absolute;

            right:20%;
            border: none;
            bottom: 10%;
        }
        .fh {
            width: 40%;
            height: 6%;
            background: url("/modes/ui/p3_button_1.png") center repeat ;
            background-size: 100% 100%;
            position: absolute;

            left:5%;
            border: none;
            bottom: 8%;
        }
        .yl {
            width: 50%;
            height: 6%;
            background: url("/modes/ui/p3_button_2.png") center no-repeat ;
            background-size: 100% 100%;
            position: absolute;

            right:5%;
            border: none;
            bottom: 8%;
        }
        .box2 {

            width: 25%;
            height: 4%;
            left:37.5%;
            top: 20%;
            position: absolute;
        }
        .box7 {
            width: 80%;
            height: 10%;
            background-size: 100% 100%;
            position: absolute;
            left:10%;
            border: none;
            top: 4%;
        }.box5 {
             width: 80%;
             height: 50%;

                     background: url("/modes/absd/ui/p2_bg_box.png");
                     background-size: 100% 100%;
                     position: absolute;
                     left:10%;
                     border: none;
                     top: 25%;
                     bottom: 25%;

         }
        .showpic {
             width: 100%;
             height: 100%;

             background-size: 100% 100%;
             position: absolute;

             border: none;

            display: none;
         }
        .showpic1 {
            width: 100%;
            height: 100%;

            background-size: 100% 100%;
            position: absolute;

            border: none;

            display: none;
        }
        .showpic2 {
            width: 100%;
            height: 100%;

            background-size: 100% 100%;
            position: absolute;

            border: none;

            display: none;
        }
        .box8 {
            width: 40%;
            height: 10%;

            background-size: 100% 100%;
            position: absolute;
            display: none;
            left: 30%;
            border: none;
            bottom: 5%;
        }
        .box9 {
            width: 100%;
            height: 10%;
            background: url("/modes/ui/p1_button_1.png") center no-repeat;
            background-size: 100% 100%;
            position: absolute;


            border: none;
            bottom: 20%;
        }

        source{
            min-width: 100%;
            min-height: 100%;
            height: auto;
            width: auto;
        }
        .container1 {
            width: 100%; height: 100%;
            margin: auto;
            background-color: #000;
            padding-left: 0px;
            padding-right: 0px;

        }
        .container1 > img {
            position: absolute;
            width: 100%; height: 100%;
        }
        .loading {
            position: absolute;
            height: 8px; width: 150px;
            border: 0px solid #eee;
            background: linear-gradient(to top, #eee, #eee);
            background-size: 0 100%;
            transition: background-size .1s;
            left: 0; top: 0; right: 0; bottom: 0;
            margin: auto;
        }
        .loading::before {
            content: attr(data-percent)'%';
            position: absolute;
            left: 0; top: -1.5em;
            font-size: 12px;
            color: #eee;
        }
        .modename{
            width: 25%;
            height: 4%;
            left:37.5%;
            top: 76%;
            position: absolute;

        }
        .modelist1{
            width:60%;
            height: 30%;
            left:-35%;
            top: 35%;
            position: absolute;
        }
        .modelist2{
            width:60%;
            height: 30%;
            left:20%;
            top: 35%;
            position: absolute;
        }
        .modelist3{
            width:60%;
            height: 30%;
            left:75%;
            top: 35%;
            position: absolute;
        }
        .modelist4{
            width:60%;
            height:30%;
            left:130%;
            top: 35%;
            position: absolute;
        }
        .modelist5{
            width:60%;
            height: 30%;
            left:185%;
            top: 35%;
            position: absolute;
        }
        .modelist6{
            width:60%;
            height: 30%;
            left:240%;
            top: 35%;
            position: absolute;
        }
        .modelist7{
            width:60%;
            height: 30%;
            left:295%;
            top: 35%;
            position: absolute;
        }
        .modelist8{
            width:60%;
            height: 30%;
            left:350%;
            top: 35%;
            position: absolute;
        }
        .modelist9{
            width:60%;
            height: 30%;
            left:405%;
            top: 35%;
            position: absolute;
        }
        .modelist10{
            width:60%;
            height: 30%;
            left:460%;
            top: 35%;
            position: absolute;
        }
        .list{
            width:100%;
            height: 100%;
            left:0%;
            top: 0%;
            position: absolute;
        }
        .bigtp{
            width:100%;
            height: 45%;
            left:0%;
            top: 18%;
            position: absolute;
        }
        .ysxz1{
            width: 30%;
            height: 14%;
            left: 5%;
            bottom: 24%;
            position: absolute;
        }
        .ysxz2{
            width: 30%;
            height: 14%;
            left: 35%;
            bottom: 24%;
            position: absolute;
        }
        .ysxz3{
            width: 30%;
            height: 14%;
            left: 65%;
            bottom: 24%;
            position: absolute;
        }
        .check{
            width: 30%;
            height: 14%;
            left: 5%;
            bottom: 24%;
            position: absolute;
        }
        .taiz{
            width: 100%;

            height: 10%;
            bottom: 20%;
            position: absolute;

        }
        .fh1 {
            width: 40%;
            height: 6%;
            background: url("/modes/ui/p4_button_1.png") center repeat ;
            background-size: 100% 100%;
            position: absolute;

            left:5%;
            border: none;
            bottom: 8%;
        }
        .yl1 {
            width: 50%;
            height: 6%;
            background: url("/modes/ui/p4_button_2.png") center no-repeat ;
            background-size: 100% 100%;
            position: absolute;

            right:5%;
            border: none;
            bottom: 8%;
        }
        .ts{
            width: 80%;
            display: none;
            bottom: 35%;
            left: 10%;
            position: absolute;
        }
        .load{
            width: 20%;
            display: block;
            bottom: 40%;
            left: 40%;
            position: absolute;
        }

    </style>
</head>

<body >


<script th:src="@{/three.js-r102/build/three.js}"></script>
<script th:src="@{/three.js-r102/examples/js/libs/inflate.min.js}"></script>
<script th:src="@{/three.js-r102/examples/js/loaders/FBXLoader.js}"></script>
<script th:src="@{/three.js-r102/examples/js/controls/OrbitControls.js}"></script>
<script th:src="@{/three.js-r102/examples/js/WebGL.js}"></script>
<script th:src="@{/three.js-r102/examples/js/libs/stats.min.js}"></script>
<script th:src="@{/three.js-r102/examples/js/loaders/GLTFLoader.js}"></script>
<script th:src="@{/three.js-r102/examples/js/loaders/AssimpJSONLoader.js}"></script>
<script th:src="@{/three.js-r102/examples/js/pmrem/PMREMGenerator.js}"></script>
<script th:src="@{/three.js-r102/examples/js/pmrem/PMREMCubeUVPacker.js}"></script>
<div id="showpic2" class="showpic2">
    <img class="box7"  src="/modes/ui/p4_title.png">
    <img src="/modes/ui/p4_bg_box.png" class="taiz">
    <button class="fh1" id="fh1" onclick="fh1()"></button>
    <button class="yl1" id="tp"  onclick="onfs()"></button>
    <img src="/modes/ui/p4_pop.png" class="ts" id="ts" onclick="onts()" >
</div>
<div id="container1" class="container1">
    <img src="/modes/ui/tutieshi.gif">
</div>
<!--<img class="box7" id="photos1"></img>
<img class="box5"  id="photos2"></img>
<img class="box6" id="photos3"></img>-->

    <div id="showpic" class="showpic" >

        <img class="box7" src="/modes/ui/p2_title.png">
        <img id="modetitle" class="box2" src="/modes/ui/p2_number_01.png">
        <img class="box5">
        <img id="modename" class="modename" src="/modes/ui/p2_name_10.png">
        <div id="list" class="list">
            <img id="modelist1" class="modelist1" src="/modes/ui/p2_model_01.png" onclick="djtp(1)">
            <img id="modelist2" class="modelist2" src="/modes/ui/p2_model_02_active.png" onclick="djtp(2)">
            <img id="modelist3" class="modelist3" src="/modes/ui/p2_model_03.png" onclick="djtp(3)">
            <img id="modelist4" class="modelist4" src="/modes/ui/p2_model_04.png" onclick="djtp(4)">
            <img id="modelist5" class="modelist5" src="/modes/ui/p2_model_05.png" onclick="djtp(5)">
            <img id="modelist6" class="modelist6" src="/modes/ui/p2_model_06.png" onclick="djtp(6)">
            <img id="modelist7" class="modelist7" src="/modes/ui/p2_model_07.png" onclick="djtp(7)">
            <img id="modelist8" class="modelist8" src="/modes/ui/p2_model_08.png" onclick="djtp(8)">
            <img id="modelist9" class="modelist9" src="/modes/ui/p2_model_09.png" onclick="djtp(9)">
            <img id="modelist10" class="modelist10" src="/modes/ui/p2_model_10.png" onclick="djtp(10)">
        </div>
        <button class="box3" id="huan1" onclick="ll()"></button>
        <button class="box4" id="huan"  onclick="rr()"></button>
    </div>

    <div id="showpic1" class="showpic1">

        <img class="box7"  src="/modes/ui/p3_title.png">
        <img  id="bigtp" src="" class="bigtp">
        <img src="/modes/ui/p3_checked.png" class="check" id="check">
        <img  id="ys1" src="/modes/ui/p3_model_01_c1.png" class="ysxz1" onclick="onys(1)" >
        <img  id="ys2" src="/modes/ui/p3_model_01_c2.png" class="ysxz2"  onclick="onys(2)">
        <img  id="ys3" src="/modes/ui/p3_model_01_c3.png" class="ysxz3" onclick="onys(3)">
        <button class="fh" id="fh" onclick="fh()"></button>
        <button class="yl" id="yl"  onclick="yl()"></button>
        <img src="/modes/ui/loading (1).gif" class="load" id="load" title="加载中">
    </div>




    <button class="box8 but2 btn btn-primary" id="fs" >2</button>
    <button class="box9" id="start"></button>



<script>

    var container, stats, controls;
    var camera, scene, renderer, light,model,loader,light1,plan;

    var clock = new THREE.Clock();
     var modename=["yhy/宇航员.FBX","rzwx/rzwx.fbx","yzfc/yzfc.fbx","zrfxq/zrfxq.fbx","kjz/05.fbx","tktcy/weixing.FBX","hxc/火星车.fbx","ys/mod_yunshi_1.FBX","ufo/UFO_.FBX","wxr/wxr_daozhu.FBX"];
     var texurl=["/yhy/身体","/rzwx/satellite_c","yzfc/spacecraft_c","zrfxq/aircraft_c","kjz/kjz","tktcy/weixin","hxc/huoxingche","ys/yunashi","ufo/UFO","wxr/waixingren"];
     var yss=["ys/mod_yunshi_2.FBX","ys/mod_yunshi_3.FBX"];
     var ys1;
     var ys2;
     var ys3;
    var mixer;
    var material1,material2,material3,material4;
    var fbx=Array(12);
    var btn=document.getElementById("huan");
    var btn1=document.getElementById("huan1");
    var modelist=document.getElementById("list");
   // var p1=document.getElementById("photos1");
   // var p2=document.getElementById("photos2");
   // var p3=document.getElementById("photos3");
    var but2=document.getElementById("fs");
    var butstart=document.getElementById("start");
    var x=1;
    var met=new Array(10);
    var websocker=null;
    var count=1;
    var maxcount=10;
    var  mincount=0;
    var buttflag=1;
    var pnum=1;
    var playbg=true;
    var stopmove=null;
    var y=1;
    var tarnum=0;
    var active=null;
    var prenum=-1;
    var xznum=-1;
    var a=false;
    var ism=false;
    var ist=false;
    var loading=0;

    var isload=false;
    if('WebSocket' in window){
        websocker=new WebSocket("ws://makeshows.top/websocket");
    }else{
        alert("不支持websocket");

    }
    window.onbeforeunload = function(){
        websocker.close();
    }/*
    websocket.onmessage = function(event){
       alert(event.data);
    }*/
    /*p1.onclick=function (){
        pnum=1;

        model.material=material1;

    }
    p2.onclick=function (){
        pnum=2;

        model.material=material2;
    }
    p3.onclick=function (){
        pnum=3;

        model.material=material3;
    }*/
    function onfs(){
        document.getElementById('ts').style.display="block";
        var temp=(xznum-1)*3+pnum;
        websocker.send("ok,"+temp);
        setTimeout(xsts,5000);
    }
    function xsts(){
        document.getElementById('ts').style.display="none";
    }

    function  fh1(){
      //  scene.remove(model);
        camera.position.set( 0, 0, 300 );
        model.visible=false;
        document.getElementById('showpic1').style.display="block";
        document.getElementById('showpic2').style.display="none";
    }
    function tt(){
        scene.add(model);
    }
    function yl(){
        if(!isload){
            return;

        }
        camera.position.set( 0, 0, 300 );
        if(pnum==1){
            if(count==0){

                model.children[0].material=material1;
            }else {
                model.material=material1;
            }

        }else if(pnum==2){
            if(count==0){

                model.children[0].material=material2;
            }else {
                model.material=material2;
            }

        }else if (pnum==2){
            if(count==0){

                model.children[0].material=material3;
            }else {
                model.material=material3;
            }

        }
        console.log(model);
        model.visible=true;
        if(count==7){
            scene.add(model);
            model.material=material1;
        }
        //

        document.getElementById('showpic1').style.display="none";
        document.getElementById('showpic2').style.display="block";

    }
    function  fh(){
        isload=false;
        camera.position.set( 0, 0, 300 );
        document.getElementById('showpic').style.display="block";
        document.getElementById('showpic1').style.display="none";
        scene.remove(model);
    }

    function onys(num){

        pnum=num;
        var t=document.getElementById("bigtp");
        if(xznum<=9){
            t.src= "/modes/ui/modeTex/0"+(xznum)+"0"+num+".png";

        }else {
            t.src= "/modes/ui/modeTex/"+(xznum)+"0"+num+".png";

        }
        if(num==1){
            if(count==7){
                console.log(ys1);
                model=ys1;
            }
            document.getElementById("check").style.left="5%";
            if(count==0){

                model.children[0].material=material1;
            }else {
                model.material=material1;
            }


        }else if (num==2){

            if(count==7){
                console.log(ys2);
                model=ys2;
            }
            document.getElementById("check").style.left="35%";
            if(count==0){

                model.children[0].material=material2;
            }else {
                model.material=material2;
            }

        }else if(num==3){
            if(count==7){
                console.log(ys3);
                model=ys3;
            }
            document.getElementById("check").style.left="65%";

            if(count==0){

                model.children[0].material=material3;
            }else {
                model.material=material3;
            }


        }





    }
    function djtp(num){
        xznum=num;
        document.getElementById('load').style.display="block";
        count=num-1;
        ghmodel('/modes/absd/'+modename[xznum-1],'/modes/absd/'+texurl[xznum-1],buttflag,xznum-1);
        var t=document.getElementById("bigtp");
        if(xznum<=9){
            t.src= "/modes/ui/modeTex/0"+(xznum)+"01.png";
            console.log("/modes/ui/modeTex/0"+(xznum)+"01.png");
            document.getElementById("ys1").src="/modes/ui/p3_model_0"+xznum+"_c1.png"
            document.getElementById("ys2").src="/modes/ui/p3_model_0"+xznum+"_c2.png"
            document.getElementById("ys3").src="/modes/ui/p3_model_0"+xznum+"_c3.png"
        }else {
            t.src= "/modes/ui/modeTex/"+(xznum)+"01.png";
            document.getElementById("ys1").src="/modes/ui/p3_model_"+xznum+"_c1.png"
            document.getElementById("ys2").src="/modes/ui/p3_model_"+xznum+"_c2.png"
            document.getElementById("ys3").src="/modes/ui/p3_model_"+xznum+"_c3.png"
        }
        document.getElementById('showpic').style.display="none";
        document.getElementById('showpic1').style.display="block";
        onys(1);


    }

    butstart.onclick=function () {
        playbg=false;
        document.getElementById('container1').remove();
        document.getElementById('start').style.display="none";
        document.getElementById('showpic').style.display="block"
    }
    but2.onclick=function (){
        var temp=count*3+pnum;
        websocker.send("ok,"+temp);
    }
    function rr() {
        if((count-1)<0){
        return;
       }
        if(a){
            return;
        }
        a=true;
        console.log(count);

        if(--count<=mincount){
            count=0;

        }
        if(tarnum>=55){
            return

        }
        tarnum=tarnum+55;
        if(tarnum>=55){
            tarnum==55;
        }
        buttflag=2;
        console.log(count);
        ghtp();
        stopmove=setInterval("dirright()",8);

       // p1.src="/img/hxce.png";
       // ghmodel('/modes/absd/'+modename[count],'/modes/absd/'+texurl[count],buttflag,count);

    }
    function ghtp(){
        var title=document.getElementById("modetitle");
        var name=document.getElementById("modename");
        if(prenum!=-1){
            if(prenum!=9){
                active.src="/modes/ui/p2_model_0"+(prenum+1)+".png"
            }else {
                active.src="/modes/ui/p2_model_"+(prenum+1)+".png"
            }
        }
        var id="modelist"+(count+1);
        active=document.getElementById(id);

        if(count<=8){
            active.src="/modes/ui/p2_model_0"+(count+1)+"_active.png"
            title.src="/modes/ui/p2_number_0"+(count+1)+".png";
            name.src="/modes/ui/p2_name_0"+(count+1)+".png";
        }else{
            active.src="/modes/ui/p2_model_"+(count+1)+"_active.png"
            title.src="/modes/ui/p2_number_"+(count+1)+".png";
            name.src="/modes/ui/p2_name_"+(count+1)+".png";
        }

        prenum=count;


    }
    function dirright(){
        var str=modelist.style.left.replace("%","");
        var  num=Number(str);
        num+=y*0.1
        console.log(tarnum+"  "+num);
        modelist.style.left=num+"%";
        if(num>=tarnum){
            modelist.style.left=tarnum+"%";
            y=1;
            a=false;
            clearInterval(stopmove);

        }else {
            y=20;
        }


    }
    function dirleft(){

        var str=modelist.style.left.replace("%","");
        var  num=Number(str);
        num-=y*0.1

        modelist.style.left=num+"%";
        console.log(tarnum+"  "+modelist.style.left);
        if(num<=tarnum){
            modelist.style.left=tarnum+"%";

            y=1;
            a=false;
            console.log(y);
            clearInterval(stopmove);

        }else{
            y=20;

        }


    }
    function ll(){

        if((count+1)>9){
        return;
    }
        if(a){
            return;
        }
        a=true;
        console.log(count);

        if(++count>=maxcount){
            count=maxcount-1;

        }
        if(tarnum<=-440){
            return;
        }
        tarnum=tarnum-55;
        if(tarnum<=-460){
            tarnum=-460;
        }
        console.log(count);
        ghtp();
        stopmove=setInterval("dirleft()",8);
        buttflag=1;
      // ghmodel('/modes/absd/'+modename[count],'/modes/absd/'+texurl[count],buttflag,count);

    }
    if ( WEBGL.isWebGLAvailable() === false ) {

        document.body.appendChild( WEBGL.getWebGLErrorMessage() );

    }

   // indexvideo();
    init();
    //initm();
    animate();
    document.getElementById('showpic2').style.display="none"

    function indexvideo(){
        var urlRoot = '/modes/absd/ui/bg/';
        var indexRange = [1, 1];
        var maxLength = indexRange[1] - indexRange[0] + 1;
// loading
        var eleContainer = document.getElementById('container1');
        var eleLoading = document.getElementById('loading');
// 存储预加载的DOM对象和长度信息
        var store = {
            length: 0
        };
// 图片序列预加载
        for ( var start = indexRange[0]; start <= indexRange[1]; start++) {
            (function (index) {
                var img = new Image();
                img.onload = function () {
                    store.length++;
                    // 存储预加载的图片对象
                    store[index] = this;
                    play();
                };
                img.onerror = function () {
                    store.length++;
                    play();
                };
                img.src = urlRoot+" ("+index+")"+'.jpg';
            })(start);
        }

        var play = function () {
            // loading进度
            var percent = Math.round(100 * store.length / maxLength);
         //   eleLoading.setAttribute('data-percent', percent);
          //  eleLoading.style.backgroundSize = percent + '% 100%';
            // 全部加载完毕，无论成功还是失败
            if (percent == 100) {
                var index = indexRange[0];
                eleContainer.innerHTML = '';
                // 依次append图片对象
                var step = function () {
                    if (store[index - 1]) {
                        eleContainer.removeChild(store[index - 1]);
                    }
                    eleContainer.appendChild(store[index]);
                    // 序列增加
                    index++;
                    if(index==indexRange[1]){
                        if(playbg){
                            index=indexRange[0];
                        }


                    }
                    // 如果超过最大限制
                    if (index <= indexRange[1]) {
                        setTimeout(step, 42);
                    } else {
                        // 本段播放结束回调
                        // 我这里就放一个重新播放的按钮
                    }
                };
                // 等100%动画结束后执行播放
                setTimeout(step, 100);
            }
        };
    }
    function  ghmodel(modelurl,ppath,dir,count){
        console.log(loading);
        loader = new THREE.FBXLoader();
        loader.load(modelurl,function(fbxObject){
            console.log(fbxObject);
            if(count==4){
                var mesh=fbxObject.children[0].clone();
            }else if(count==0){
                var mesh=fbxObject.clone();

            }
            else{
                var mesh=fbxObject.children[0].clone();
            }


           // mesh.material =met[count];
            camera.position.set( 0, 0, 300 );
            model=mesh;
            model.visible=false;
            scene.add(mesh);

                if(count==0){
                    model.position.set(0,-30,0);
                    model.scale.set(6,6,6);
                }else if(count==1){
                    model.position.set(0,0,0);
                    model.scale.set(6,6,6);

                }else if (count==2){
                    model.position.set(0,0,0);
                    model.scale.set(6,6,6);

                }else if (count==3){
                    model.position.set(0,0,0);
                    model.scale.set(6,6,6);

                }
                    else if(count==7){
                    ys1=model;
                    model.position.set(0,0,0);
                    model.scale.set(0.2,0.2,0.2);
                }else if(count==9){
                    model.position.set(0,-30,0);
                    model.scale.set(6,6,6);
                }else if(count==4){
                    model.position.set(0,0,0);
                    model.scale.set(5,5,5);
                }else if(count==6){
                    model.position.set(0,10,0);
                    model.scale.set(0.04,0.04,0.04);

                }
                else{
                    model.position.set(0,0,0);
                    model.scale.set(4,4,4);
                }
            loadmat();
            ism=true;
            pnum=1;

            if(document.getElementById('showpic2').style.display=="block"){
                model.visible=true;
                controls.update();
                renderer.render( scene, camera );
            }
            if(loading!=100){

                    loading+=25;


                console.log(loading);
                if(loading==100){
                    document.getElementById("load").style.display="none";
                    isload=true;
                    loading=0;
                }

            }
            if(count==7){
                loader.load('/modes/absd/'+yss[0],function(fbxObject){
                    var mesh=fbxObject.children[0].clone();
                    mesh.position.set(0,0,0);
                    mesh.scale.set(0.1,0.1,0.1);
                    ys2=mesh;
                    ys2.visible=false;

                });
                loader.load('/modes/absd/'+yss[1],function(fbxObject){
                    var mesh=fbxObject.children[0].clone();
                    mesh.position.set(0,0,0);
                    mesh.scale.set(0.1,0.1,0.1);
                    ys3=mesh
                    ys3.visible=false;

                });

            }
        });

    }
    function initm(){
        var  tex=new THREE.TextureLoader();
        var a1=tex.load('/modes/absd/'+texurl[0]+'1.jpg');
        met[0]=new THREE.MeshStandardMaterial({
            map:a1,
            roughness:0.1,
            metalness:0.1,

        });
        a1=tex.load('/modes/absd/'+texurl[1]+'1.jpg');
        met[1]=new THREE.MeshStandardMaterial({
            map:a1,
            roughness:0.1,
            metalness:0.1,

        });
        a1=tex.load('/modes/absd/'+texurl[2]+'1.jpg');
        met[2]=new THREE.MeshStandardMaterial({
            map:a1,
            roughness:0.1,
            metalness:0.1,

        });
        a1=tex.load('/modes/absd/'+texurl[3]+'1.jpg');
        met[3]=new THREE.MeshStandardMaterial({
            map:a1,
            roughness:0.1,
            metalness:0.1,

        });
        a1=tex.load('/modes/absd/'+texurl[4]+'1.jpg');
        met[4]=new THREE.MeshStandardMaterial({
            map:a1,
            roughness:0.1,
            metalness:0.1,

        });
        a1=tex.load('/modes/absd/'+texurl[5]+'1.jpg');
        met[5]=new THREE.MeshStandardMaterial({
            map:a1,
            roughness:0.1,
            metalness:0.1,

        });
        a1=tex.load('/modes/absd/'+texurl[6]+'1.jpg');
        met[6]=new THREE.MeshStandardMaterial({
            map:a1,
            roughness:0.1,
            metalness:0.1,

        });
        a1=tex.load('/modes/absd/'+texurl[7]+'1.jpg');
        met[7]=new THREE.MeshStandardMaterial({
            map:a1,
            roughness:0.1,
            metalness:0.1,

        });


    }
    function loadmat(url){
        var  tex=new THREE.TextureLoader();
        var a4=tex.load('/modes/absd/ufo/fg.jpg');

        var a1=tex.load('/modes/absd/'+texurl[count]+'1.jpg',function (texture) {


            if(count==8){
                material1 =new THREE.MeshStandardMaterial({
                    map:texture,
                    roughness:0.1,
                    metalness:0.4,
                    emissiveMap:a4,
                    emissive:0x0000ff

                });

            }
            else if(count==4){
                material1 =new THREE.MeshStandardMaterial({
                        map:texture,
                        roughness:0.1,
                        metalness:0.4,
                       color: 0xffffff

                    }

                );
            }else if(count==0){

                material1 =new THREE.MeshStandardMaterial({
                        map:texture,
                        roughness:1,
                        metalness:0.6,

                    }

                );
            }
            else {
                material1 =new THREE.MeshStandardMaterial({
                        map:texture,
                        roughness:0.1,
                        metalness:0.4,

                    }

                );
            }
            if(loading!=100){
                loading+=25;
                console.log(loading);
                if(loading==100){
                    document.getElementById("load").style.display="none";
                    isload=true;
                    loading=0;
                }

            }

        });


        var a2=tex.load('/modes/absd/'+texurl[count]+'2.jpg',function (tex) {
            if(count==8){
                material2 =new THREE.MeshStandardMaterial({
                    map:tex,
                    roughness:0.1,
                    metalness:0.4,
                    emissiveMap:a4,
                    emissive: 0xea53ff

                });

            } else if(count==4){
                material2 =new THREE.MeshStandardMaterial({
                        map:tex,
                        roughness:0.1,
                        metalness:0.4,
                    color: 0xffffff

                    }

                );
            }else if(count==0){

                material2 =new THREE.MeshStandardMaterial({
                        map:tex,
                        roughness:1,
                        metalness:0.6

                    }

                );
            }
            else {
                material2 =new THREE.MeshStandardMaterial({
                    map:tex,
                    roughness:0.1,
                    metalness:0.4,
                });
            }
            if(loading!=100){
                loading+=25;
                console.log(loading);
                if(loading==100){
                    document.getElementById("load").style.display="none";
                    isload=true;
                    loading=0;
                }

            }
        });

        var a3=tex.load('/modes/absd/'+texurl[count]+'3.jpg',function (tex) {
            if(count==8){
                material3 =new THREE.MeshStandardMaterial({
                    map:tex,
                    roughness:0.1,
                    metalness:0.4,
                    emissiveMap:a4,
                    emissive:0xffffff


                });

            } else if(count==4){
                material3 =new THREE.MeshStandardMaterial({
                        map:tex,
                        roughness:0.1,
                        metalness:0.4,
                    color: 0xffffff

                    }

                );
            }else if(count==0){

                material3 =new THREE.MeshStandardMaterial({
                        map:tex,
                        roughness:1,
                        metalness:0.6

                    }

                );
            }
            else {
                material3 =new THREE.MeshStandardMaterial({
                    map:tex,
                    roughness:0.1,
                    metalness:0.4,
                });
            }
            if(loading!=100){
                loading+=25;
                console.log(loading);
                if(loading==100){
                    document.getElementById("load").style.display="none";
                    isload=true;
                    loading=0;
                }

            }
        });

        if(count==0){
            material4=new THREE.MeshStandardMaterial({
                color:0xC2C2C2,
                roughness:0.6,
                metalness:0.75,
                opacity:0.8,
            });
            model.children[1].material=material4;
        }

       /* if(pnum==1){
            if(count==0){

                model.children[7].material=material1;
            }else {
                model.material=material1;
            }


        }else if(pnum==2){
            if(count==0){

                model.children[7].material=material2;
            }else {
                model.material=material2;
            }
        }else if (pnum==2){
            if(count==0){
                model.children[7].material=material3;
            }else {
                model.material=material3
            }
        }*/
       ist=true;


    }
    function init() {

        container = document.createElement( 'div' );
        document.body.appendChild( container );
        document.body.addEventListener('touchmove', function (e) {undefined
            e.preventDefault();
        }, {passive: false});
        camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
        camera.position.set( 0, 0, 300 );

        controls = new THREE.OrbitControls( camera);

        controls.update();

        scene = new THREE.Scene();
       // scene.background = new THREE.Color( 0x000000);
        scene.fog = new THREE.Fog( 0xa0a0a0, 200, 1000 );

        light = new THREE.HemisphereLight( 0xffffff, 0x444444 );
        light.intensity=1;
        //console.log(light);
        light.position.set( 800, 200, 100 );
        scene.add( light );
        //环境光    环境光颜色与网格模型的颜色进行RGB进行乘法运算
        var ambient = new THREE.AmbientLight(0x888888);
        scene.add(ambient);
 
        light = new THREE.DirectionalLight( 0xffffff );
        light.position.set( -300, 200, 200 );
        light.castShadow = true;
        light.shadow.camera.top = 180;
        light.shadow.camera.bottom = - 100;
        light.shadow.camera.left = - 120;
        light.shadow.camera.right = 120;
        scene.add( light );

        light1 = new THREE.DirectionalLight( 0xffffff );
        light.position.set( 500, 200, 200 );
        light.castShadow = true;
        light.shadow.camera.top = 180;
        light.shadow.camera.bottom = - 100;
        light.shadow.camera.left = - 120;
        light.shadow.camera.right = 120;

        var point = new THREE.PointLight(0xffffff);
        point.position.set(34.19, 94.57, 37.48); //点光源位置
        // 通过add方法插入场景中，不插入的话，渲染的时候不会获取光源的信息进行光照计算
      //  scene.add(point); //点光源添加到场景中
        var point1 = new THREE.PointLight(0xffffff);
        point.position.set(-87.50, 14.156, 0); //点光源位置
        // 通过add方法插入场景中，不插入的话，渲染的时候不会获取光源的信息进行光照计算
        scene.add(point1); //点光源添加到场景中
        var point2 = new THREE.PointLight(0xffffff);
        point.position.set(-77.42, -38.26, 50.42); //点光源位置
        // 通过add方法插入场景中，不插入的话，渲染的时候不会获取光源的信息进行光照计算
        scene.add(point2); //点光源添加到场景中

        //scene.add( light1 );
        // scene.add( new THREE.CameraHelper( light.shadow.camera ) );

        var planeGeometry = new THREE.PlaneBufferGeometry( 400, 400);
        planeGeometry.translate(0, 0, -400); // 平面几何体位置
// 背景纹理
        var planeTexture = new THREE.TextureLoader().load('/modes/ui/p4_bg_box.png');
// 背景材料
        var planeMaterial = new THREE.MeshBasicMaterial({
            map: planeTexture
        });
// 背景网格
        plan = new THREE.Mesh(planeGeometry, planeMaterial);
// 将背景添加到场景


      //  scene.add( grid );

       /* var fbxModelfilepath = '/modes/absd/wxr/wxr_daozhu.fbx';
        loader = new THREE.FBXLoader();
        loader.load(fbxModelfilepath,function(fbxObject){
            fbxObject.traverse(function(child){
                if(child instanceof THREE.Mesh)
                {
                    if(child.name.indexOf("Body") != -1)
                    {
                        // 如果贴图格式为tga则使用THREE.TGALoader
                        // var loader = new THREE.TGALoader();
                        // 如果贴图格式为其他普通格式，则使用Three.TextureLoader
                        var loadert = new Three.TextureLoader();
                        loadert.load(
                            'waixingren1.jpg',   // 本地路径的图片

                            // 加载完贴图后的回调函数
                            function (texture) {
                                child.material.map = texture;
                                child.material.needsUpdate = true;
                                console.log("身体贴图更新完毕");
                            },

                            // 目前不支持加载贴图过程中的回调函数
                            undefined,

                            // 加载出错时候的回调函数
                            function (err) {
                                console.error('An error happened.');
                            }
                        );

                    }
                }
            });

           var mesh=fbxObject.children[0].clone();


            mesh.material =material2;


            scene.add(mesh);
            model=mesh;
            model.scale.set(8,8,8);
            model.position.set(100,-50,0);
            setTimeout(initm,1000);
        });*/

        renderer = new THREE.WebGLRenderer( { antialias: true , alpha : true} );
        renderer.setClearAlpha(0.1);
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.shadowMap.enabled = true;
        container.appendChild( renderer.domElement );

        window.addEventListener( 'resize', onWindowResize, false );

        // stats
        //stats = new Stats();
       // container.appendChild( stats.dom );


    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

    }

    //

    function animate() {

        requestAnimationFrame( animate );

        var delta = clock.getDelta();
        //model.position.set(0,-100,0);



               /* if(model!=null){
                    if(model.position.x<0&&buttflag==2){

                        model.position.x+=x*0.5;

                        x+=0.2;

                    }else if(model.position.x>0&&buttflag==1){
                        model.position.x-=x*0.5;

                        x+=0.2;
                    }
                    else{

                        if(model.position!=0){
                            model.position.x=0;
                            x=1;
                        }
                    }

                }*/





        controls.update();
        renderer.render( scene, camera );


    }
    var startx, starty;
    //获得角度
    function getAngle(angx, angy) {
        return Math.atan2(angy, angx) * 180 / Math.PI;
    };

    //根据起点终点返回方向 1向上 2向下 3向左 4向右 0未滑动
    function getDirection(startx, starty, endx, endy) {
        var angx = endx - startx;
        var angy = endy - starty;
        var result = 0;

        //如果滑动距离太短
        if (Math.abs(angx) < 2 && Math.abs(angy) < 2) {
            return result;
        }

        var angle = getAngle(angx, angy);
        if (angle >= -135 && angle <= -45) {
            result = 1;
        } else if (angle > 45 && angle < 135) {
            result = 2;
        } else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
            result = 3;
        } else if (angle >= -45 && angle <= 45) {
            result = 4;
        }

        return result;
    }
    //手指接触屏幕
    document.addEventListener("touchstart", function(e) {
        startx = e.touches[0].pageX;
        starty = e.touches[0].pageY;
    }, false);
    //手指离开屏幕
    document.addEventListener("touchend", function(e) {
        var endx, endy;
        endx = e.changedTouches[0].pageX;
        endy = e.changedTouches[0].pageY;
        var direction = getDirection(startx, starty, endx, endy);
        switch (direction) {
            case 0:
             //   alert("未滑动！");
                break;
            case 1:
              //  alert("向上！")
                break;
            case 2:
              //  alert("向下！")
                break;
            case 3:
                if(document.getElementById('showpic').style.display=="block")
                {
                    ll();
                }
                break;
            case 4:
                console.log(document.getElementById('showpic2').style.display);
              if(document.getElementById('showpic').style.display=="block")
              {
                  rr();
              }
                break;
            default:
        }
    }, false);
</script>

</body>
</html>
