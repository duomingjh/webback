<!DOCTYPE html>
<html lang="en">
<head>
    <title>测试</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <style>
        body {
            font-family: Monospace;
            background: url("/img/bg3.jpg") center no-repeat;
            background-size: 100% 100%;

            color: #fff;
            margin: 0px;
            overflow: hidden;
        }
        #info {
            color: #fff;
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            z-index: 100;
            display:block;
        }
        #info a {
            color: #046;
            font-weight: bold;
        }
        .box4 {
            width: 20%;
            height: 15%;
            background: url("/img/jt2.png") center repeat ;
            background-size: 100% 100%;
            position: absolute;
            top: 40%;
            left:0px;
            border: none;
            bottom: 40%;
        }
        .box3 {
            width: 20%;
            height: 15%;
            background: url("/img/jt.png") center no-repeat ;
            background-size: 100% 100%;
            position: absolute;
            top: 40%;
            right:0px;
            border: none;
            bottom: 40%;
        }

    </style>
</head>

<body>


<script th:src="@{/three.js-r102/build/three.js}"></script>
<script th:src="@{/three.js-r102/examples/js/libs/inflate.min.js}"></script>
<script th:src="@{/three.js-r102/examples/js/loaders/FBXLoader.js}"></script>
<script th:src="@{/three.js-r102/examples/js/controls/OrbitControls.js}"></script>
<script th:src="@{/three.js-r102/examples/js/WebGL.js}"></script>
<script th:src="@{/three.js-r102/examples/js/libs/stats.min.js}"></script>
<script th:src="@{/three.js-r102/examples/js/loaders/GLTFLoader.js}"></script>


    <button class="box4" id="huan">1</button>
    <button class="box3" id="huan1">2</button>



<script>

    var container, stats, controls;
    var camera, scene, renderer, light,model,loader;

    var clock = new THREE.Clock();
     var modename=["yhy.glb","恐龙_03.glb"]
    var mixer;
    var btn=document.getElementById("huan");
    var btn1=document.getElementById("huan1");
    var x=1;
    var websocker=null;
    var count=0;
    var maxcount=2;
    var  mincount=0;
    var buttflag=1;
    if('WebSocket' in window){

        websocker=new WebSocket("ws://192.168.1.20:1112/websocket");
    }else{
        alert("不支持websocket");

    }
    window.onbeforeunload = function(){
        websocker.close();
    }/*
    websocket.onmessage = function(event){
       alert(event.data);
    }*/

    btn1.onclick=function () {
        websocker.send("你好");
        if(++count>=maxcount){
            count=0;

        }
        buttflag=1;
        console.log(count);
        loader.load( '/modes/absd/'+modename[count], function ( gltf ) {
            scene.remove(model);
            scene.add( gltf.scene );
            model=gltf.scene;
            model.position.set(-100,-100,0);

        }, undefined, function ( error ) {

            console.error( error );

        } );

    }

    btn.onclick=function (){
        var ajax=new XMLHttpRequest();
        ajax.open('get','http://192.168.1.20:1112/webapi/mode?id=1');
        ajax.send();
        if(--count<mincount){
            count=maxcount-1;

        }
        buttflag=2;
        loader.load( '/modes/absd/'+modename[count], function ( gltf ) {
            scene.remove(model);
            scene.add( gltf.scene );
             model=gltf.scene;
             model.position.set(100,-100,0);

        }, undefined, function ( error ) {

            console.error( error );

        } );

    }
    if ( WEBGL.isWebGLAvailable() === false ) {

        document.body.appendChild( WEBGL.getWebGLErrorMessage() );

    }


    init();
    animate();

    function init() {

        container = document.createElement( 'div' );
        document.body.appendChild( container );
        document.body.addEventListener('touchmove', function (e) {undefined
            e.preventDefault();
        }, {passive: false});
        camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
        camera.position.set( 0, 0, 300 );


        controls = new THREE.OrbitControls( camera);

        controls.update();

        scene = new THREE.Scene();
       // scene.background = new THREE.Color( 0x000000 );
        scene.fog = new THREE.Fog( 0xa0a0a0, 200, 1000 );

        light = new THREE.HemisphereLight( 0xffffff, 0x444444 );
        light.position.set( 0, 200, 0 );
        scene.add( light );

        light = new THREE.DirectionalLight( 0xffffff );
        light.position.set( 0, 200, 100 );
        light.castShadow = true;
        light.shadow.camera.top = 180;
        light.shadow.camera.bottom = - 100;
        light.shadow.camera.left = - 120;
        light.shadow.camera.right = 120;
      //  scene.add( light );

        // scene.add( new THREE.CameraHelper( light.shadow.camera ) );

        // ground
        var mesh = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2000, 2000 ), new THREE.MeshPhongMaterial( { color: 0x999999, depthWrite: false } ) );
        mesh.rotation.x = - Math.PI / 2;
        mesh.receiveShadow = true;
       // scene.add( mesh );

        var grid = new THREE.GridHelper( 2000, 20, 0x000000, 0x000000 );
        grid.material.opacity = 0.2;
        grid.material.transparent = true;
      //  scene.add( grid );
         loader = new THREE.GLTFLoader();

        loader.load( '/modes/absd/yhy.glb', function ( gltf ) {

            scene.add( gltf.scene );
            model=gltf.scene;

            model.position.set(-100,-100,0);
            model.material.transparent=true;
            model.material.opacity=0.1;

        }, undefined, function ( error ) {

            console.error( error );

        } );
        // model

        renderer = new THREE.WebGLRenderer( { antialias: true , alpha : true} );
        renderer.setClearAlpha(0.1);
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.shadowMap.enabled = true;
        container.appendChild( renderer.domElement );

        window.addEventListener( 'resize', onWindowResize, false );

        // stats
        //stats = new Stats();
       // container.appendChild( stats.dom );

    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

    }

    //

    function animate() {

        requestAnimationFrame( animate );

        var delta = clock.getDelta();
      //  model.position.set(0,-100,0);

            console.log(model.position.x);

           if(model.position.x<0&&buttflag==1){

               model.position.x+=x;

                x+=0.4;

           }else if(model.position.x>0&&buttflag==2){
               model.position.x-=x;

               x+=0.4;
           }
           else{

               if(model.position!=0){
                   model.position.x=0;
                   x=1;
               }
           }







        controls.update();
        renderer.render( scene, camera );


    }

</script>

</body>
</html>
